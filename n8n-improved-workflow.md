# n8n 워크플로우 개선 가이드

## 현재 워크플로우 분석

현재 n8n 워크플로우는 다음과 같은 주요 단계로 구성되어 있습니다:

1. 트리거: Manual Trigger를 통한 수동 시작
2. 심볼 설정: "Edit Fields" 노드에서 "TSLA" 설정
3. 병렬 처리:
   - RSS 피드에서 뉴스 수집 → API에 감성 분석 요청 → Supabase DB 저장
   - 기술 지표 분석 API 호출 → Supabase DB 저장
   - 전략 계산 API 호출 → 결과를 전략별로 분할 → Supabase DB 저장

## 개선 제안

### 1. 워크플로우 자동화

```
[Time Trigger: 매일 오전 9시] → [Symbol List] → [Loop] → ... (기존 흐름) ...
```

- `Time Trigger` 노드를 추가하여 매일 시장 개장 전에 자동 실행
- 여러 종목을 처리할 수 있는 리스트와 루프 구조 추가

### 2. 오류 처리 개선

```
[HTTP Request] → [IF] → [성공 분기] / [오류 처리 분기] → [오류 알림]
```

- API 호출 후 HTTP 응답 코드 확인
- 오류 발생 시 Slack, 이메일 등으로 알림 전송

### 3. 데이터 필터링 및 전처리

```
[뉴스 수집] → [필터: 6시간 이내] → [중복 제거] → [감성 분석 API]
```

- 최신 뉴스만 수집하도록 필터링
- 중복 처리 방지를 위한 필터 추가

### 4. 매매 조건 자동화

```
[전략 계산 API] → [필터: score > 0.8] → [IF: 전략 조건 충족] → [매매 실행/알림]
```

- 전략 점수가 높은 경우만 자동 매매 실행
- 매매 조건 충족 시 알림 전송

## 데이터 저장 최적화

현재 DB 저장 구조를 그대로 유지하되, 다음 사항을 개선합니다:

1. **중복 데이터 방지**:
   - 뉴스 데이터: URL을 기준으로 중복 체크
   - 기술 지표: 심볼 + 타임스탬프 기준 중복 체크
   - 전략 결과: 심볼 + 전략 이름 + 날짜 기준 중복 체크

2. **데이터 보관 정책**:
   - 오래된 데이터 자동 정리 (예: 30일 이상 데이터 삭제)
   - 요약 데이터 생성 (예: 일별 감성 점수 평균)

## 모니터링 통합

```
[매일 종료 시] → [결과 요약] → [성과 보고서 생성] → [알림 전송]
```

- 일일 성과 요약 및 보고서 생성
- 다음 날 전략 추천

이러한 개선 사항을 구현하면 워크플로우의 자동화 수준과 안정성이 크게 향상될 것입니다.
